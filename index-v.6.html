<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Festive Offer @ B4 Unisex Salon</title>
  <style>
    body{
      display:flex;align-items:center;justify-content:center;
      height:100vh;margin:0;font-family:Arial, sans-serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .wheel-container{position:relative;width:420px;height:420px;}
    canvas{width:100%;height:100%;border-radius:50%;background:white;box-shadow:0 6px 18px rgba(0,0,0,.12);}
    .pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:0;height:0;
      border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid red;
      z-index:10;transition:border-bottom-color .25s ease;}
    .pointer.winner{border-bottom-color:green;}
    .center-box{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:150px;height:150px;border-radius:50%;
      background:#008000;display:flex;align-items:center;justify-content:center;z-index:5;cursor:pointer;
      box-shadow:0 0 20px rgba(0,0,0,.5),0 0 30px #00ff88,0 0 60px #00ff88;transition:transform .18s ease;
    }
    .center-box:hover{transform:translate(-50%,-50%) scale(1.05);}
    .center-text{color:#fff;font-weight:700;text-align:center;padding:10px;font-size:16px;animation:glow 1.5s infinite alternate;}
    @keyframes glow{from{text-shadow:0 0 5px #fff,0 0 10px #ff00de} to{text-shadow:0 0 10px #fff,0 0 20px #00eaff}}
    .star{
      position:absolute;width:12px;height:12px;background:yellow;
      clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
      animation:burst 1s ease-out forwards;z-index:20;
    }
    @keyframes burst{0%{transform:translate(0,0) scale(.5);opacity:1}100%{transform:translate(var(--x),var(--y)) scale(1.5);opacity:0}}
  </style>
</head>
<body>
  <div class="wheel-container">
    <div class="pointer" id="pointer"></div>
    <canvas id="wheel" width="420" height="420"></canvas>
    <div class="center-box" id="center-box"><span class="center-text" id="center-text">B4 Unisex Salon</span></div>
  </div>

<script>
/* ------- setup ------- */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const pointer = document.getElementById('pointer');
const centerBox = document.getElementById('center-box');
const centerText = document.getElementById('center-text');

/* slices */
const discounts = [
  "5%", "10%", "15%", "20%", "25%", "30%",
  "35%", "40%", "45%", "50%", "60%", "70%"
];
const validDiscounts = new Set(["5%","10%","15%","20%","25%","30%"]);

const radius = canvas.width/2;
const numSegments = discounts.length;
const anglePerSegment = (2*Math.PI)/numSegments;

/* base rotation so segment 0 center is at pointer when angle=0 */
const baseRotation = -Math.PI/2 - anglePerSegment/2;

/* drawing */
function drawWheel(){
  for(let i=0;i<numSegments;i++){
    const start = i*anglePerSegment;
    const end = start + anglePerSegment;
    ctx.beginPath();
    ctx.moveTo(radius,radius);
    ctx.arc(radius,radius,radius,start,end);
    ctx.closePath();
    ctx.fillStyle = `hsl(${i*30},70%,60%)`;
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 1;
    ctx.stroke();

    // label
    ctx.save();
    ctx.translate(radius,radius);
    ctx.rotate(start + anglePerSegment/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#000';
    ctx.font = 'bold 16px Arial';
    ctx.fillText(discounts[i], radius - 12, 8);
    ctx.restore();
  }
}

/* initial draw with optional rotation angle */
function initialDraw(angle = 0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(radius,radius);
  ctx.rotate(baseRotation + angle);
  ctx.translate(-radius,-radius);
  drawWheel();
  ctx.restore();
}
initialDraw();

/* animation state */
let spinning = false;
let startTime = null;
let duration = 4200; // ms
let finalAngle = 0; // target rotation to animate to
let targetIndex = null;

/* starburst */
function createStars(){
  for(let i=0;i<12;i++){
    const s = document.createElement('div');
    s.className = 'star';
    const angle = Math.random()*Math.PI*2;
    const dist = 60 + Math.random()*60;
    s.style.setProperty('--x', `${Math.cos(angle)*dist}px`);
    s.style.setProperty('--y', `${Math.sin(angle)*dist}px`);
    centerBox.appendChild(s);
    setTimeout(()=> s.remove(), 1000);
  }
}

/* ease-out cubic */
function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

/* spinner frame */
function animateSpin(ts){
  if (!startTime) startTime = ts;
  const elapsed = ts - startTime;
  const progress = Math.min(elapsed/duration, 1);
  const eased = easeOutCubic(progress);
  const currentAngle = finalAngle * eased; // angle passed into initialDraw

  initialDraw(currentAngle);

  if (progress < 1){
    requestAnimationFrame(animateSpin);
    return;
  }

  // ended
  spinning = false;
  pointer.classList.add('winner');
  const discount = discounts[targetIndex];
  centerText.innerText = `You Won: ${discount} Discount ðŸŽ‰`;
  createStars();
}

/* click handler: choose a valid slice and compute finalAngle so it lands exactly under pointer */
/* IMPORTANT: to align segment k, use finalAngle = totalSpins*2Ï€ - k*anglePerSegment */
centerBox.addEventListener('click', ()=>{
  if (spinning) return;
  spinning = true;
  pointer.classList.remove('winner');
  centerText.innerText = 'B4 Unisex Salon';

  // pick random index only among valid discounts
  const validIndexes = discounts.map((d,i)=> validDiscounts.has(d)? i : null).filter(i=>i!==null);
  targetIndex = validIndexes[Math.floor(Math.random()*validIndexes.length)];

  // compute angle: many full spins minus offset so chosen slice center ends at top pointer
  const extraSpins = Math.floor(Math.random()*3) + 5; // 5-7 full spins
  finalAngle = extraSpins * 2 * Math.PI - targetIndex * anglePerSegment;

  // reset animation state
  startTime = null;
  requestAnimationFrame(animateSpin);
});
</script>
</body>
</html>

